# 개발 계획서: 프로젝트 "OpenTycoon Godot"

이 문서는 Godot 엔진 4.x를 사용하여 RCT2와 유사한 아이소메트릭 놀이동산 경영 시뮬레이션 게임을 개발하기 위한 계획을 설명합니다.

## 1. 프로젝트 개요 및 목표
Godot을 이용하여 플레이어가 테마파크를 관리하는 2D 아이소메트릭 시뮬레이션 게임을 제작합니다.
**핵심 철학**: 데이터와 시각화의 분리. 파크 시뮬레이션은 순수한 데이터 그리드 상에서 실행되며, Godot은 이를 시각화하고 입력을 처리하는 역할만 수행합니다.

## 2. 기술 아키텍처

### 2.1 좌표계 (Coordinate Systems)
세 가지 좌표 공간을 다루어야 합니다:
1.  **그리드 좌표 (Vector3i)**: `(x, y, z)` - 파크 데이터 모델 내의 논리적 위치.
2.  **아이소메트릭 좌표 (Vector2)**: `(iso_x, iso_y)` - 스프라이트 배치를 위한 2D 투영 좌표.
3.  **스크린 좌표 (Vector2)**: 사용자 화면상의 최종 픽셀 위치.

### 2.2 핵심 시스템
*   **ParkMap (데이터 모델)**: `TileData` (지형 타입, 높이, 오브젝트 점유 정보)를 저장하는 3D 배열 또는 딕셔너리.
*   **IsoRenderer (뷰)**:
    *   **Y-Sorting**이 활성화된 **Node2D**를 사용.
    *   그리드 셀을 뒤에서 앞으로(back-to-front) 렌더링.
    *   대형 오브젝트(롤러코스터 등)는 올바른 깊이 정렬(Depth Sorting)을 위해 타일 단위 스프라이트로 분할.
*   **Pathfinder (시뮬레이션)**:
    *   다리/터널 등 3D 요구사항으로 인해 표준 `AStarGrid2D`를 단순히 사용하기 어려움.
    *   **해결책**: `AStar3D` 구현 (혹은 노드 그래프 기반의 커스텀 A*)을 통해 논리적 노드 간의 연결(계단/경사로 포함)을 처리.
*   **Guest Agent (관람객)**:
    *   시각화: 4방향 스프라이트 프레임을 가진 `Sprite2D`.
    *   로직: 단순 상태 머신 (배회, 목적지로 이동, 줄 서기, 탑승).

## 3. 구현 로드맵

### 1단계: 기초 작업 (그리드 및 카메라)
*   [ ] **프로젝트 설정**: Godot 프로젝트 초기화, 기본 아이소메트릭 타일 에셋 가져오기.
*   [ ] **IsoCamera**: 팬(Pan), 줌(Zoom) 및 좌표 변환(스크린 <-> 그리드)을 처리하는 카메라 구현.
*   [ ] **그리드 렌더링**: `TileMapLayer` 또는 `Sprite2D`를 사용하여 평평한 잔디 타일 영역을 생성하는 스크립트 작성.
*   [ ] **하이라이트 시스템**: 마우스 커서 아래에 그리드에 딱 맞는 "커서" 박스 표시.D

### 2단계:건설 및 경로
*   [ ] **데이터 구조**: 타일의 높이와 타입을 저장하는 `ParkMap` 클래스 구현.
*   [ ] **지형 도구**: 땅을 높이고 낮추는 기능 (시각적 스프라이트 오프셋 수정).
*   [ ] **경로(길) 배치**: 인접한 길 타일을 연결하는 로직 (오토타일링 로직).
*   [ ] **오브젝트 배치**: 정적 장식물(나무, 벽) 배치 및 충돌/점유 확인.

### 3단계: 관람객 및 내비게이션
*   [ ] **입구 게이트**: 관람객 스폰 지점.
*   [ ] **NavGraph**: `ParkMap` 경로 데이터로부터 연결 그래프를 구축하는 시스템.
*   [ ] **Guest AI**:
    *   관람객 스폰.
    *   무작위 유효 트랙 노드까지의 경로 계산.
    *   경로를 따라 관람객 이동 (시각적 보간).

### 4단계: 경제 및 평면 놀이기구 (Flat Rides)
*   [ ] **경제 매니저**: 플레이어 자금, 티켓 가격 추적.
*   [ ] **놀이기구 기본 클래스**: 놀이기구 정의 (입구, 출구, 크기, 흥미도).
*   [ ] **평면 놀이기구 구현**: 관람객이 탑승할 수 있는 단순 애니메이션 놀이기구 (예: 회전목마).
*   [ ] **대기열 로직**: 줄을 서서 기다리는 관람객 처리.

### 5단계: 롤러코스터 (심화)
*   *최적화 경고: 복잡한 스프라이트 관리가 필요합니다.*
*   [ ] **트랙 건설 UI**: 트랙 조각 선택 인터페이스 (직선, 커브, 상승 경사, 나선).
*   [ ] **트랙 데이터**: 조각들의 연결 체인 저장.
*   [ ] **물리 모델**: 트랙을 따라 카트를 이동시키기 위한 에너지 보존 시뮬레이션 (위치 에너지 vs 운동 에너지).

## 4. 검증 계획 (Verification Plan)

### 자동화 테스트
*   **단위 테스트 (`test/unit/`)**:
    *   `test_coordinate_conversion.gd`: (0,0,0) 그리드 좌표가 올바른 스크린 픽셀로 매핑되는지 확인.
    *   `test_pathfinding.gd`: 간단한 경로 루프를 만들고 A*가 좌표를 찾아내는지 확인.
    *   `test_economy.gd`: 건설 시 자금이 올바르게 차감되는지 확인.

### 수동 검증
*   **시각적 로직**:
    *   벽 건설 후 관람객이 벽 뒤로 걸어갈 때 벽에 의해 올바르게 가려지는지 확인 (Z-sorting).
    *   다리 건설 후 관람객이 다리 밑으로 지나가는지, 다른 관람객은 다리 위로 지나가는지, 둘 다 올바르게 렌더링되는지 확인.
